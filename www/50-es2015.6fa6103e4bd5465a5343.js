(window.webpackJsonp=window.webpackJsonp||[]).push([[50],{zlTR:function(a,i,t){"use strict";t.r(i),t.d(i,"AcademicoTurmaNotaAlunosPageModule",(function(){return T}));var o=t("ofXK"),n=t("3Pt+"),c=t("TEn/"),e=t("tyNb"),r=t("mrSG"),s=t("amDQ"),l=t("fXoL"),b=t("afdR"),u=t("g8ne"),d=t("cI5j");function A(a,i){if(1&a){const a=l.Rb();l.Qb(0,"div",8),l.Qb(1,"ion-button",9),l.Yb("click",(function(){l.sc(a);const i=l.bc(2);return i.exibirFiltro=!i.exibirFiltro})),l.Mb(2,"ion-icon",10),l.Cc(3," Ocultar filtro "),l.Pb(),l.Pb()}}function h(a,i){if(1&a&&(l.Qb(0,"ion-select-option",13),l.Cc(1),l.Pb()),2&a){const a=i.$implicit;l.ic("value",a.IDF_DISCIPLINA),l.zb(1),l.Ec(" ",a.DES_DISCIPLINA,"")}}function g(a,i){if(1&a){const a=l.Rb();l.Qb(0,"ion-select",11),l.Yb("ngModelChange",(function(i){return l.sc(a),l.bc(2).dados.disciplina=i}))("ionChange",(function(){return l.sc(a),l.bc(2).syncAvaliacoes()})),l.Ac(1,h,2,2,"ion-select-option",12),l.Pb()}if(2&a){const a=l.bc(2);l.hc("cancelText","Cancelar")("ngModel",a.dados.disciplina),l.zb(1),l.hc("ngForOf",a.turmaAtiva.disciplinas)}}function v(a,i){if(1&a&&(l.Ob(0),l.Ac(1,A,4,0,"div",3),l.Qb(2,"ion-row"),l.Qb(3,"ion-col"),l.Qb(4,"h4",4),l.Cc(5,"Sele\xe7\xe3o da "),l.Qb(6,"b"),l.Cc(7,"disciplina"),l.Pb(),l.Pb(),l.Pb(),l.Pb(),l.Qb(8,"ion-list",5),l.Qb(9,"ion-item",6),l.Qb(10,"ion-label"),l.Cc(11,"Disciplina"),l.Pb(),l.Ac(12,g,2,3,"ion-select",7),l.Pb(),l.Pb(),l.Nb()),2&a){const a=l.bc();l.zb(1),l.hc("ngIf",a.dados.disciplina&&a.dados.avaliacao),l.zb(11),l.hc("ngIf",a.turmaAtiva.disciplinas&&a.turmaAtiva.disciplinas.length>0)}}function f(a,i){if(1&a){const a=l.Rb();l.Qb(0,"div",8),l.Qb(1,"ion-button",14),l.Yb("click",(function(){l.sc(a);const i=l.bc();return i.exibirFiltro=!i.exibirFiltro})),l.Mb(2,"ion-icon",10),l.Cc(3," Alterar filtro "),l.Pb(),l.Pb()}}function m(a,i){if(1&a){const a=l.Rb();l.Ob(0),l.Qb(1,"ion-col",28),l.Qb(2,"div",29),l.Qb(3,"ion-item",30),l.Qb(4,"ion-label",31),l.Cc(5),l.Pb(),l.Qb(6,"ion-input",32),l.Yb("ionChange",(function(t){l.sc(a);const o=i.index,n=l.bc(2).$implicit;return l.bc(3).atualizarNotaAluno(n,o,t)})),l.Pb(),l.Pb(),l.Pb(),l.Pb(),l.Nb()}if(2&a){const a=i.index,t=l.bc(2).$implicit,o=l.bc(3);l.zb(1),l.hc("size",12/o.numNotas),l.zb(4),l.Ec("",a+1,"\xaa nota"),l.zb(1),l.jc("name","nota_",a,""),l.hc("placeholder","Nota")("value",null==t.avaliacao.NOTAS[a]?null:t.avaliacao.NOTAS[a].valor)}}function p(a,i){if(1&a&&(l.Qb(0,"ion-item",20),l.Qb(1,"ion-grid"),l.Qb(2,"ion-row"),l.Qb(3,"ion-col",21),l.Qb(4,"ion-avatar"),l.Mb(5,"img",22),l.Pb(),l.Pb(),l.Qb(6,"ion-col",23),l.Qb(7,"p",24),l.Qb(8,"b",25),l.Cc(9),l.Pb(),l.Mb(10,"br"),l.Qb(11,"b"),l.Cc(12),l.Pb(),l.Pb(),l.Pb(),l.Qb(13,"ion-col",26),l.Qb(14,"p",27),l.Qb(15,"b"),l.Cc(16,"M\xe9dia:"),l.Pb(),l.Mb(17,"br"),l.Cc(18),l.cc(19,"number"),l.Pb(),l.Pb(),l.Pb(),l.Qb(20,"ion-row"),l.Ac(21,m,7,5,"ng-container",18),l.Pb(),l.Pb(),l.Pb()),2&a){const a=l.bc().$implicit,i=l.bc(3);l.zb(5),l.jc("src","assets/img/avatar-",2==a.sexo?"menina":"menino",".jpg",l.uc),l.zb(4),l.Dc(i.cub3Svc.normalizeString(a.nomeCivil)),l.zb(3),l.Dc(a.id),l.zb(6),l.Ec(" ",l.ec(19,5,a.avaliacao.media||0,"1.2-2"),""),l.zb(3),l.hc("ngForOf",a.avaliacao.NOTAS)}}function O(a,i){if(1&a&&(l.Ob(0),l.Ac(1,p,22,8,"ion-item",19),l.Nb()),2&a){const a=i.$implicit;l.zb(1),l.hc("ngIf",a)}}function N(a,i){if(1&a){const a=l.Rb();l.Ob(0),l.Qb(1,"ion-searchbar",16),l.Yb("ngModelChange",(function(i){return l.sc(a),l.bc(2).busca=i})),l.Pb(),l.Qb(2,"ion-list",17),l.Ac(3,O,2,1,"ng-container",18),l.Pb(),l.Nb()}if(2&a){const a=l.bc(2);l.zb(1),l.hc("ngModel",a.busca),l.zb(2),l.hc("ngForOf",a.ListarAlunos())}}function I(a,i){1&a&&l.Mb(0,"ion-spinner",33)}function C(a,i){if(1&a&&(l.Ob(0),l.Qb(1,"ion-row"),l.Qb(2,"ion-col"),l.Qb(3,"h4",4),l.Cc(4,"Alunos da "),l.Qb(5,"b"),l.Cc(6,"turma"),l.Pb(),l.Pb(),l.Pb(),l.Pb(),l.Ac(7,N,4,2,"ng-container",2),l.Ac(8,I,1,0,"ion-spinner",15),l.Nb()),2&a){const a=l.bc();l.zb(7),l.hc("ngIf",null!=a.dados&&!a.carregando),l.zb(1),l.hc("ngIf",null!=a.carregando&&1==a.carregando)}}const P=[{path:"",component:(()=>{class a{constructor(a,i,t,o,n,c){this.route=a,this.router=i,this.location=t,this.cd=o,this.cub3Svc=n,this.cub3Db=c,this.turmaAtiva={NME_TURMA:""},this.data={MOB_DISCIPLINAS:[],MOB_AVALIACOES:[]},this.dados={},this.busca="",this.carregando=!0,this.alunosDisponiveis=[],this.exibirFiltro=!0,this.idAvaliacao=null,this.numNotas=4}ngOnInit(){this.route.url.subscribe(()=>{this.route.snapshot.params.id&&"undefined"!=this.route.snapshot.params.id?(this.turmaAtiva.IDF_TURMA=this.route.snapshot.params.id,this.idAvaliacao=this.route.snapshot.params.idAvaliacao,console.log("Params",this.route.snapshot.params),this.init()):this.location.back()})}ionViewWillEnter(){this.data=s.a.getItem("data"),this.dados.disciplina&&this.dados.avaliacao&&this.atualizarAlunos()}init(){return Object(r.a)(this,void 0,void 0,(function*(){let a=yield this.cub3Svc.getTurmas();this.turmaAtiva=a.find(a=>a.id==this.turmaAtiva.IDF_TURMA),console.log("Iniciando turma",this.turmaAtiva),this.cd.markForCheck(),this.iniciarTurma()}))}iniciarTurma(){return Object(r.a)(this,void 0,void 0,(function*(){this.getDisciplinas()}))}getDisciplinas(){return Object(r.a)(this,void 0,void 0,(function*(){this.data.MOB_DISCIPLINAS=[];try{this.data.MOB_DISCIPLINAS=this.turmaAtiva.disciplinas}catch(a){}this.cd.markForCheck()}))}syncAvaliacoes(){return Object(r.a)(this,void 0,void 0,(function*(){this.getAlunos(),this.getAvaliacoes()}))}getAvaliacoes(){return Object(r.a)(this,void 0,void 0,(function*(){return this.turmaAtiva.avaliacoes}))}atualizarAlunos(){let a=this.data.MOB_AVALIACOES_ALUNOS||[];for(let i of a)for(let a of this.dados.alunos)a.NOTA.IDF_AVALIACAO==i.IDF_AVALIACAO&&a.IDF_ALUNO==i.IDF_ALUNO&&(a.NOTA.FALTAS=i.FALTAS,a.NOTA.NOTA=i.NOTA)}calcularMediaNotas(a){const i=a.map(a=>{const i=parseFloat(a.valor);return isNaN(i)?null:i}).filter(a=>null!==a),t=i.reduce((a,i)=>a+i,0);return i.length>0?t/i.length:0}atualizarNotaAluno(a,i,t){return Object(r.a)(this,void 0,void 0,(function*(){console.log(`Atualizando nota ${i} do aluno ${a.id}`);try{let o=(yield this.cub3Db.getStorage("MOV_REGISTRO_NOTA"))||[],n=o.find(i=>i.IDF_ALUNO===a.id&&parseInt(i.IDF_AVALIACAO)===parseInt(this.idAvaliacao));const c=t.detail.value;if(a.avaliacao.NOTAS[i].valor=c?parseFloat(c):"",n)n.NOTAS=this.adjustNotasArraySize(n.NOTAS||[]),n.NOTAS[i].valor=a.avaliacao.NOTAS[i].valor,n.media=this.calcularMediaNotas(n.NOTAS);else{let t=this.adjustNotasArraySize([]);t[i].valor=a.avaliacao.NOTAS[i].valor;const n={IDF_ALUNO:a.id,IDF_TURMA:this.turmaAtiva.id,IDF_AVALIACAO:this.idAvaliacao,NOTAS:t,media:this.calcularMediaNotas(t)};o.push(n)}a.avaliacao.media=this.calcularMediaNotas(a.avaliacao.NOTAS),yield this.cub3Db.setStorage("MOV_REGISTRO_NOTA",o),console.log(`Nota ${i} atualizada no banco para o aluno ${a.id}`),this.cub3Svc.alertaToast("Nota atualizada","Nota atualizada com sucesso!")}catch(o){console.error("Erro ao atualizar a nota no banco",o),this.cub3Svc.alertaToast("Ops!","Erro ao atualizar a nota. Por favor, tente novamente.")}}))}getAlunos(){return Object(r.a)(this,void 0,void 0,(function*(){this.carregando=!0,this.exibirFiltro=!1;let a=this.idAvaliacao,i=this.turmaAtiva.alunos;const t=(yield this.cub3Db.getStorage("MOV_REGISTRO_NOTA"))||[];this.dados.alunos=i.map(i=>{i.avaliacoes||(i.avaliacoes=[]);let o=i.avaliacoes.find(i=>parseInt(i.IDF_AVALIACAO)===parseInt(a));if(o)if(i.avaliacao=o,i.avaliacao.NOTAS&&Array.isArray(i.avaliacao.NOTAS))i.avaliacao.NOTAS=this.adjustNotasArraySize(i.avaliacao.NOTAS);else{i.avaliacao.NOTAS=[];for(let a=0;a<this.numNotas;a++)i.avaliacao.NOTAS.push({id:a,valor:""})}else{i.avaliacao={IDF_ALUNO:i.id,NOTAS:[],IDF_AVALIACAO:a,media:0};for(let a=0;a<this.numNotas;a++)i.avaliacao.NOTAS.push({id:a,valor:""});i.avaliacoes.push(i.avaliacao)}try{const o=t.find(t=>parseInt(t.IDF_ALUNO)===parseInt(i.id)&&parseInt(t.IDF_AVALIACAO)===parseInt(a)&&t.NOTAS&&Array.isArray(t.NOTAS));o&&(i.avaliacao.NOTAS=[...o.NOTAS],i.avaliacao.NOTAS=this.adjustNotasArraySize(i.avaliacao.NOTAS),i.avaliacao.media=o.media||0)}catch(n){console.error("Erro ao recuperar as notas do armazenamento",n)}return i}),console.log("Alunos com avalia\xe7\xf5es atualizadas",this.dados.alunos),setTimeout(()=>{this.carregando=!1,this.cd.markForCheck()},100)}))}adjustNotasArraySize(a){return(a=(a=a.flat()).map((a,i)=>{var t;return"object"==typeof a&&null!==a&&"valor"in a?{id:null!==(t=a.id)&&void 0!==t?t:i,valor:a.valor}:{id:i,valor:a}})).length<this.numNotas?[...a,...Array.from({length:this.numNotas-a.length},(i,t)=>({id:a.length+t,valor:""}))]:a.length>this.numNotas?a.slice(0,this.numNotas):a}getTituloAvaliacao(){try{return this.turmaAtiva.avaliacoes.find(a=>parseInt(a.IDF_AVALIACAO)==this.idAvaliacao||parseInt(a.NRO_AVALIACAO)==this.idAvaliacao).DES_AVALIACAO}catch(a){return""}}filtrar(a,i=""){return a.filter(a=>a.id==i||a.nome.toLowerCase().indexOf(i.toLowerCase())>-1)}ListarAlunos(){return""!=this.busca?this.filtrar(this.dados.alunos,this.busca):this.dados.alunos}abrirNotaModal(a,i){let t=btoa(JSON.stringify(Object.assign({},a)));console.log(t),this.router.navigate(["/app/academico/academico-turma-nota-aluno/"+t])}}return a.\u0275fac=function(i){return new(i||a)(l.Lb(e.a),l.Lb(e.g),l.Lb(o.n),l.Lb(l.h),l.Lb(b.a),l.Lb(u.a))},a.\u0275cmp=l.Fb({type:a,selectors:[["app-academico-turma-nota-alunos"]],decls:9,vars:9,consts:[[3,"titulo","voltar","icone","exibirAvatar"],[1,"header-4",2,"padding-left","10px"],[4,"ngIf"],["class","box-filtro",4,"ngIf"],[1,"header4"],[1,"notify-list"],["lines","none"],["placeholder","Selecione...",3,"cancelText","ngModel","ngModelChange","ionChange",4,"ngIf"],[1,"box-filtro"],["fill","outline","color","danger","size","small",1,"btn-filtro",3,"click"],["name","filter-outline"],["placeholder","Selecione...",3,"cancelText","ngModel","ngModelChange","ionChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["fill","outline","size","small",1,"btn-filtro",3,"click"],["name","crescent","class","carregando","color","primary",4,"ngIf"],["showCancelButton","focus","placeholder","Buscar por nome ou matr\xedcula...",3,"ngModel","ngModelChange"],[1,"alunos-lista","listOpcoes"],[4,"ngFor","ngForOf"],["style","margin-bottom:10px;",4,"ngIf"],[2,"margin-bottom","10px"],["size","1"],[3,"src"],["size","9"],[1,"turmaDias",2,"position","relative"],[2,"color","black"],["size","2",2,"display","flex","justify-content","center","align-items","center"],[2,"text-align","center"],[3,"size"],[2,"display","flex"],[2,"background","white","--inner-padding-start","0","--inner-padding-end","0","--inner-padding-top","0","--inner-padding-bottom","0"],["position","stacked"],["type","number","min","0","max","10",2,"width","100%","color","black","text-align","center",3,"placeholder","value","name","ionChange"],["name","crescent","color","primary",1,"carregando"]],template:function(a,i){1&a&&(l.Mb(0,"cub3-header",0),l.Qb(1,"ion-content"),l.Qb(2,"ion-row"),l.Qb(3,"ion-col"),l.Qb(4,"h4",1),l.Cc(5),l.Pb(),l.Pb(),l.Pb(),l.Ac(6,v,13,2,"ng-container",2),l.Ac(7,f,4,0,"div",3),l.Ac(8,C,9,2,"ng-container",2),l.Pb()),2&a&&(l.hc("titulo","Notas <br /> <b>"+i.turmaAtiva.NME_TURMA+"</b>")("voltar",!0)("icone","bookmarks-outline")("exibirAvatar",!1),l.zb(5),l.Fc("Notas ",i.turmaAtiva.titulo," - ",i.getTituloAvaliacao(),""),l.zb(1),l.hc("ngIf",i.exibirFiltro),l.zb(1),l.hc("ngIf",!i.exibirFiltro),l.zb(1),l.hc("ngIf",i.dados.disciplina))},directives:[d.a,c.u,c.gb,c.t,o.t,c.O,c.H,c.N,c.k,c.C,c.kb,c.Lb,n.j,n.m,o.s,c.lb,c.hb,c.Mb,c.A,c.f,c.G,c.Hb,c.pb],pipes:[o.g],styles:["ion-spinner[_ngcontent-%COMP%]{margin:10px auto;display:block}.col-btn[_ngcontent-%COMP%], .col-btn[_ngcontent-%COMP%]   ion-row[_ngcontent-%COMP%], .col-faltas[_ngcontent-%COMP%], .col-faltas[_ngcontent-%COMP%]   ion-row[_ngcontent-%COMP%], .col-notas[_ngcontent-%COMP%], .col-notas[_ngcontent-%COMP%]   ion-row[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;flex-direction:column}.col-btn[_ngcontent-%COMP%]   ion-row[_ngcontent-%COMP%], .col-faltas[_ngcontent-%COMP%]   ion-row[_ngcontent-%COMP%], .col-notas[_ngcontent-%COMP%]   ion-row[_ngcontent-%COMP%]{text-align:center}.card-aluno[_ngcontent-%COMP%]{background:#eee!important;--background:#eee!important}.box-filtro[_ngcontent-%COMP%]{width:100%;display:block;padding-right:20px;text-align:right}.box-filtro[_ngcontent-%COMP%]   .btn-filtro[_ngcontent-%COMP%]{margin:auto}"],changeDetection:0}),a})()}];let S=(()=>{class a{}return a.\u0275mod=l.Jb({type:a}),a.\u0275inj=l.Ib({factory:function(i){return new(i||a)},imports:[[e.k.forChild(P)],e.k]}),a})();var M=t("HBpY");let T=(()=>{class a{}return a.\u0275mod=l.Jb({type:a}),a.\u0275inj=l.Ib({factory:function(i){return new(i||a)},imports:[[o.c,n.e,c.Bb,M.a,S]]}),a})()}}]);